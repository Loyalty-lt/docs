---
title: "Redeem Points"
api: "POST /{locale}/shop/transactions/create"
description: "Redeem customer points for a discount"
---

# Redeem Points

Redeem loyalty points as a discount during a purchase. Points redemption is included in the [Create Transaction](/api-reference/endpoints/shop/transactions/create) endpoint.

<Info>
Points redemption happens alongside awarding new points in a single transaction.
</Info>

## How Points Redemption Works

1. Check customer's available points using [Get Card Info](/api-reference/endpoints/shop/loyalty-cards/info)
2. Calculate discount based on redemption settings
3. Apply discount to order total
4. Submit transaction with `points_redeemed` and `points_discount_amount`

## Quick Example

<RequestExample>

```bash cURL
curl -X POST "https://staging-api.loyalty.lt/en/shop/transactions/create" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your_api_key" \
  -H "X-API-Secret: your_api_secret" \
  -d '{
    "user_email": "customer@example.com",
    "order_id": "ORDER-12345",
    "order_total": 49.99,
    "points_redeemed": 500,
    "points_discount_amount": 5.00
  }'
```

```javascript JavaScript
// Step 1: Get customer's points
const cardInfo = await fetch(
  `https://staging-api.loyalty.lt/en/shop/loyalty-cards/info?user_email=customer@example.com`,
  {
    headers: {
      'X-API-Key': 'your_api_key',
      'X-API-Secret': 'your_api_secret'
    }
  }
).then(r => r.json());

const availablePoints = cardInfo.data.points;
const redemption = cardInfo.data.redemption;

// Step 2: Calculate max discount
const maxDiscount = (availablePoints / redemption.points_per_currency) * redemption.currency_amount;
console.log(`Max discount available: €${maxDiscount.toFixed(2)}`);

// Step 3: Process transaction with redemption
const response = await fetch('https://staging-api.loyalty.lt/en/shop/transactions/create', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-API-Key': 'your_api_key',
    'X-API-Secret': 'your_api_secret'
  },
  body: JSON.stringify({
    user_email: 'customer@example.com',
    order_id: 'ORDER-12345',
    order_total: 49.99,
    points_redeemed: 500,         // Points to deduct
    points_discount_amount: 5.00  // Discount applied
  })
});

const result = await response.json();
console.log(`Points earned: ${result.data.points_awarded}`);
console.log(`New balance: ${result.data.points_balance}`);
```

```php PHP
<?php
// Get customer's card info first
$cardInfo = getCardInfo($_POST['customer_email']);
$availablePoints = $cardInfo['data']['points'];
$redemption = $cardInfo['data']['redemption'];

// Calculate discount (e.g., customer wants to use 500 points)
$pointsToRedeem = min(500, $availablePoints);
$discount = ($pointsToRedeem / $redemption['points_per_currency']) * $redemption['currency_amount'];

// Create transaction with redemption
$response = wp_remote_post('https://staging-api.loyalty.lt/en/shop/transactions/create', [
    'headers' => [
        'Content-Type' => 'application/json',
        'X-API-Key' => LOYALTY_API_KEY,
        'X-API-Secret' => LOYALTY_API_SECRET,
    ],
    'body' => json_encode([
        'user_email' => $_POST['customer_email'],
        'order_id' => 'WC-' . $order_id,
        'order_total' => $order->get_total() - $discount, // After discount
        'points_redeemed' => $pointsToRedeem,
        'points_discount_amount' => $discount,
    ])
]);
```

</RequestExample>

<ResponseExample>

```json Success Response (200)
{
  "success": true,
  "message": "Points awarded successfully",
  "data": {
    "transaction_id": 12346,
    "points_awarded": 450,
    "points_balance": 1200,
    "loyalty_card_id": 567,
    "card_number": "LC00000567",
    "user_id": 123,
    "order_total": 44.99,
    "currency": "EUR"
  }
}
```

```json Insufficient Points (400)
{
  "success": false,
  "message": "Nepakanka taškų nuskaityti. Turimi: 300 taškų",
  "code": "VALIDATION_ERROR"
}
```

</ResponseExample>

## Redemption Settings

Check the card's `redemption` object for configuration:

| Field | Description |
|-------|-------------|
| `enabled` | Whether redemption is allowed |
| `points_per_currency` | Points needed for 1 currency unit |
| `currency_amount` | Currency value per redemption unit |
| `min_points` | Minimum points to redeem |
| `max_points` | Maximum points per redemption |

## Discount Calculation

```javascript
// Example: 100 points = €1.00 discount
const pointsPerEuro = redemption.points_per_currency;  // 100
const currencyPerUnit = redemption.currency_amount;    // 1.00

const discount = (pointsToRedeem / pointsPerEuro) * currencyPerUnit;
// 500 points / 100 * 1.00 = €5.00 discount
```

## Validation Rules

<Warning>
The system validates:
- User has enough points (`points >= points_redeemed`)
- Points to redeem meets minimum (`points_redeemed >= min_points`)
- Points to redeem doesn't exceed maximum (`points_redeemed <= max_points`)
</Warning>

<Card title="Full Documentation" icon="book" href="/api-reference/endpoints/shop/transactions/create">
  See Create Transaction for complete options
</Card>
